<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自定义你的情书</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', '微软雅黑', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #e74c3c;
            margin: 20px 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 16px;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        .color-picker {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
            gap: 8px;
            margin-top: 10px;
            max-width: 100%;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            transition: all 0.3s ease;
            flex-shrink: 0;
            justify-self: center;
        }
        
        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .color-option.selected {
            border-color: #333;
            transform: scale(1.15);
            box-shadow: 0 0 0 3px rgba(51, 51, 51, 0.2);
        }
        
        .color-option.selected::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            font-size: 14px;
            font-weight: bold;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        #previewButton {
            background-color: #2ecc71;
        }
        
        #previewButton:hover {
            background-color: #27ae60;
        }
        
        #resetButton {
            background-color: #e74c3c;
        }
        
        #resetButton:hover {
            background-color: #c0392b;
        }
        
        .paragraphs-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            background-color: white;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .paragraph-item {
            background-color: #f9f9f9;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .paragraph-item p {
            margin-bottom: 10px;
        }
        
        .paragraph-actions {
            display: flex;
            gap: 10px;
        }
        
        .paragraph-actions button {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .remove-paragraph {
            background-color: #e74c3c;
        }
        
        .remove-paragraph:hover {
            background-color: #c0392b;
        }
        
        .edit-paragraph {
            background-color: #f39c12;
        }
        
        .edit-paragraph:hover {
            background-color: #d35400;
        }
        
        .add-paragraph-btn {
            background-color: #2ecc71;
            margin-top: 10px;
        }
        
        .add-paragraph-btn:hover {
            background-color: #27ae60;
        }
        
        .mode-toggle {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 20px;
        }
        
        .toggle-btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #f5f5f5;
            color: #333;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .toggle-btn.active {
            background-color: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        
        .book-preview {
            width: 100%;
            height: 200px;
            background-color: #fff8f8;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }
        
        /* 花朵预览样式 */
        .flower-preview {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }
        
        .flower-container {
            position: relative;
            width: 140px;
            height: 140px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .flower-petal {
            position: absolute;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border-radius: 50% 0 50% 0;
            transform-origin: 50% 100%;
            animation: petalGlow 3s ease-in-out infinite alternate;
        }
        
        .flower-petal:nth-child(1) {
            transform: rotate(0deg) translateY(-30px);
            animation-delay: 0s;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            --rotation: 0deg;
        }
        
        .flower-petal:nth-child(2) {
            transform: rotate(72deg) translateY(-30px);
            animation-delay: 0.2s;
            background: linear-gradient(45deg, #ff7675, #fd79a8);
            --rotation: 72deg;
        }
        
        .flower-petal:nth-child(3) {
            transform: rotate(144deg) translateY(-30px);
            animation-delay: 0.4s;
            background: linear-gradient(45deg, #fd79a8, #fdcb6e);
            --rotation: 144deg;
        }
        
        .flower-petal:nth-child(4) {
            transform: rotate(216deg) translateY(-30px);
            animation-delay: 0.6s;
            background: linear-gradient(45deg, #fdcb6e, #e17055);
            --rotation: 216deg;
        }
        
        .flower-petal:nth-child(5) {
            transform: rotate(288deg) translateY(-30px);
            animation-delay: 0.8s;
            background: linear-gradient(45deg, #e17055, #ff6b6b);
            --rotation: 288deg;
        }
        
        .flower-center {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #feca57 0%, #ff9ff3 50%, #54a0ff 100%);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(254, 202, 87, 0.8);
            animation: centerPulse 2s ease-in-out infinite;
            z-index: 10;
        }
        
        .flower-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px #fff;
            animation: sparkle 1.5s linear infinite;
        }
        
        .flower-sparkle:nth-child(1) {
            top: 20%;
            left: 15%;
            animation-delay: 0s;
        }
        
        .flower-sparkle:nth-child(2) {
            top: 30%;
            right: 20%;
            animation-delay: 0.5s;
        }
        
        .flower-sparkle:nth-child(3) {
            bottom: 25%;
            left: 25%;
            animation-delay: 1s;
        }
        
        .flower-sparkle:nth-child(4) {
            bottom: 15%;
            right: 15%;
            animation-delay: 1.2s;
        }
        
        .flower-title {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            z-index: 20;
        }
        
        .flower-title h3 {
            font-size: 20px;
            margin-bottom: 5px;
            animation: titleFloat 3s ease-in-out infinite;
        }
        
        .flower-title p {
            font-size: 14px;
            opacity: 0.9;
            animation: titleFloat 3s ease-in-out infinite reverse;
        }
        
        @keyframes petalGlow {
            0% {
                filter: brightness(1) drop-shadow(0 0 5px rgba(255, 107, 107, 0.3));
                transform: rotate(var(--rotation)) translateY(-30px) scale(1);
            }
            50% {
                filter: brightness(1.2) drop-shadow(0 0 15px rgba(255, 107, 107, 0.6));
                transform: rotate(var(--rotation)) translateY(-30px) scale(1.05);
            }
            100% {
                filter: brightness(1) drop-shadow(0 0 5px rgba(255, 107, 107, 0.3));
                transform: rotate(var(--rotation)) translateY(-30px) scale(1);
            }
        }
        
        @keyframes centerPulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(254, 202, 87, 0.8);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 0 30px rgba(254, 202, 87, 1);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(254, 202, 87, 0.8);
            }
        }
        
        @keyframes sparkle {
            0% {
                opacity: 0;
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0);
            }
        }
        
        @keyframes titleFloat {
            0%, 100% {
                transform: translateX(-50%) translateY(0px);
            }
            50% {
                transform: translateX(-50%) translateY(-5px);
            }
        }
        
        .flower-container:hover .flower-petal {
            animation-duration: 1s;
        }
        
        .flower-container:hover .flower-center {
            animation-duration: 1s;
        }
        
        .flower-container:hover {
            animation: flowerSway 2s ease-in-out infinite;
        }
        
        @keyframes flowerSway {
            0%, 100% {
                transform: rotate(0deg);
            }
            25% {
                transform: rotate(2deg);
            }
            75% {
                transform: rotate(-2deg);
            }
        }
        
        /* 花朵背景粒子效果 */
        .flower-particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            animation: floatingParticle 4s linear infinite;
            pointer-events: none;
        }
        
        .flower-particle:nth-child(odd) {
            animation-duration: 3s;
        }
        
        .flower-particle:nth-child(even) {
            animation-duration: 5s;
        }
        
        @keyframes floatingParticle {
            0% {
                opacity: 0;
                transform: translateY(100px) scale(0);
            }
            10% {
                opacity: 1;
                transform: translateY(80px) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateY(-80px) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }
        
        /* 花朵光晕效果 */
        .flower-glow {
            position: absolute;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,182,193,0.3) 0%, rgba(255,182,193,0) 70%);
            border-radius: 50%;
            animation: glowPulse 3s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        
        @keyframes glowPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.3;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.6;
            }
        }
        
        .book-cover {
            width: 70%;
            height: 90%;
            background-color: #e74c3c;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
            position: relative;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.2);
            transform: perspective(800px) rotateY(15deg);
            transition: transform 0.5s ease, box-shadow 0.5s ease;
            transform-style: preserve-3d;
        }
        
        .book-cover:hover {
            transform: perspective(800px) rotateY(5deg) translateY(-5px);
            box-shadow: 8px 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .book-cover::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWDg4N3d3dtbW17e3t1dXWBgYGHh4d5eXlzc3OLi4ubm5uVlZWPj4+NjY19fX2JiYl/f39ra2uRkZGZmZlpaWmXl5dvb29xcXGTk5NnZ2c8TV1mAAAAG3RSTlNAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAvEOwtAAAFVklEQVR4XpWWB67c2BUFb3g557T/hRo9/WUMZHlgr4Bg8Z4qQgQJlHI4A8SzFVrapvmTF9O7dmYRFZ60YiBhJRCgh1FYhiLAmdvX0CzTOpNE77ME0Zty/nWWzchDtiqrmQDeuv3powQ5ta2eN0FY0InkqDD73lT9c9lEzwUNqgFHs9VQce3TVClFCQrSTfOiYkVJQBmpbq2L6iZavPnAPcoU0dSw0SUTqz/GtrGuXfbyyBniKykOWQWGqwwMA7QiYAxi+IlPdqo+hYHnUt5ZPfnsHJyNiDtnpJyayNBkF6cWoYGAMY92U2hXHF/C1M8uP/ZtYdiuj26UdAdQQSXQErwSOMzt/XWRWAz5GuSBIkwG1H3FabJ2OsUOUhGC6tK4EMtJO0ttC6IBD3kM0ve0tJwMdSfjZo+EEISaeTr9P3wYrGjXqyC1krcKdhMpxEnt5JetoulscpyzhXN5FRpuPHvbeQaKxFAEB6EN+cYN6xD7RYGpXpNndMmZgM5Dcs3YSNFDHUo2LGfZuukSWyUYirJAdYbF3MfqEKmjM+I2EfhA94iG3L7uKrR+GdWD73ydlIB+6hgref1QTlmgmbM3/LeX5GI1Ux1RWpgxpLuZ2+I+IjzZ8wqE4nilvQdkUdfhzI5QDWy+kw5Wgg2pGpeEVeCCA7b85BO3F9DzxB3cdqvBzWcmzbyMiqhzuYqtHRVG2y4x+KOlnyqla8AoWWpuBoYRxzXrfKuILl6SfiWCbjxoZJUaCBj1CjH7GIaDbc9kqBY3W/Rgjda1iqQcOJu2WW+76pZC9QG7M00dffe9hNnseupFL53r8F7YHSwJWUKP2q+k7RdsxyOB11n0xtOvnW4irMMFNV4H0uqwS5ExsmP9AxbDTc9JwgneAT5vTiUSm1E7BSflSt3bfa1tv8Di3R8n3Af7MNWzs49hmauE2wP+ttrq+AsWpFG2awvsuOqbipWHgtuvuaAE+A1Z/7gC9hesnr+7wqCwG8c5yAg3AL1fm8T9AZtp/bbJGwl1pNrE7RuOX7PeMRUERVaPpEs+yqeoSmuOlokqw49pgomjLeh7icHNlG19yjs6XXOMedYm5xH2YxpV2tc0Ro2jJfxC50ApuxGob7lMsxfTbeUv07TyYxpeLucEH1gNd4IKH2LAg5TdVhlCafZvpskfncCfx8pOhJzd76bJWeYFnFciwcYfubRc12Ip/ppIhA1/mSZ/RxjFDrJC5xifFjJpY2Xl5zXdguFqYyTR1zSp1Y9p+tktDYYSNflcxI0iyO4TPBdlRcpeqjK/piF5bklq77VSEaA+z8qmJTFzIWiitbnzR794USKBUaT0NTEsVjZqLaFVqJoPN9ODG70IPbfBHKK+/q/AWR0tJzYHRULOa4MP+W/HfGadZUbfw177G7j/OGbIs8TahLyynl4X4RinF793Oz+BU0saXtUHrVBFT/DnA3ctNPoGbs4hRIjTok8i+algT1lTHi4SxFvONKNrgQFAq2/gFnWMXgwffgYMJpiKYkmW3tTg3ZQ9Jq+f8XN+A5eeUKHWvJWJ2sgJ1Sop+wwhqFVijqWaJhwtD8MNlSBeWNNWTa5Z5kPZw5+LbVT99wqTdx29lMUH4OIG/D86ruKEauBjvH5xy6um/Sfj7ei6UUVk4AIl3MyD4MSSTOFgSwsH/QJWaQ5as7ZcmgBZkzjjU1UrQ74ci1gWBCSGHtuV1H2mhSnO3Wp/3fEV5a+4wz//6qy8JxjZsmxxy5+4w9CDNJY09T072iKG0EnOS0arEYgXqYnXcYHwjTtUNAcMelOd4xpkoqiTYICWFq0JSiPfPDQdnt+4/wuqcXY47QILbgAAAABJRU5ErkJggg==');
            opacity: 0.08;
            pointer-events: none;
            border-radius: 5px;
        }
        
        .book-preview-title {
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .book-spine {
            position: absolute;
            left: 0;
            top: 0;
            width: 10px;
            height: 100%;
            background-color: #c0392b;
            border-radius: 2px 0 0 2px;
            box-shadow: inset -2px 0 3px rgba(0, 0, 0, 0.2);
        }
        
        .book-pages {
            position: absolute;
            top: 5%;
            right: -5px;
            width: 10px;
            height: 90%;
            background-color: #fff;
            border-radius: 0 2px 2px 0;
            box-shadow: 1px 0 3px rgba(0, 0, 0, 0.2);
        }
        
        .book-pages::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                to bottom,
                #f5f5f5,
                #f5f5f5 2px,
                #fff 2px,
                #fff 4px
            );
            opacity: 0.5;
            border-radius: 0 2px 2px 0;
        }
        
        .book-decoration {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        
        .book-shine {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.3) 0%, 
                rgba(255,255,255,0) 50%, 
                rgba(255,255,255,0) 100%);
            opacity: 0.7;
            border-radius: 5px;
        }
        
        .book-bookmark {
            position: absolute;
            top: -8px;
            right: 30px;
            width: 20px;
            height: 50px;
            background-color: #f1c40f;
            border-radius: 0 0 10px 10px;
            transform: rotate(-5deg);
            box-shadow: 1px 2px 3px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }
        
        .tip-box {
            background-color: #fffce6;
            border-left: 4px solid #ffd24c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .tip-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #e67e22;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .color-picker {
                grid-template-columns: repeat(auto-fill, minmax(28px, 1fr));
                gap: 6px;
                max-height: 250px;
                padding: 8px;
            }
            
            .color-option {
                width: 28px;
                height: 28px;
            }
        }
        
        @media (max-width: 480px) {
            .color-picker {
                grid-template-columns: repeat(auto-fill, minmax(25px, 1fr));
                gap: 5px;
                max-height: 200px;
                padding: 6px;
            }
            
            .color-option {
                width: 25px;
                height: 25px;
            }
            
            .color-option.selected::after {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <h1>定制翻页情书</h1>
    
    <div class="mode-toggle">
        <div class="toggle-btn active" id="bookModeBtn">书籍样式</div>
        <div class="toggle-btn" id="flowerModeBtn">花朵样式</div>
    </div>
    
    <div class="tip-box">
        <div class="tip-title">创建提示</div>
        <p>选择您喜欢的情书样式：<strong>书籍样式</strong>将您的内容展现为精美的翻页书籍，<strong>花朵样式</strong>则以美丽绽放的花朵形式呈现爱意。</p>
        <p>每页将展示一段内容，您可以添加多个段落创造一份完整的情书。系统会自动统计字数（不含标点符号），方便您掌握内容长度。</p>
    </div>
    
    <!-- 书籍预览 -->
    <div class="book-preview" id="bookPreview">
        <div class="book-cover" id="bookCoverPreview">
            <div class="book-spine"></div>
            <div class="book-pages"></div>
            <div class="book-decoration">
                <div class="book-shine"></div>
                <div class="book-bookmark"></div>
            </div>
            <h3 class="book-preview-title">爱意成册</h3>
            <p>献给特别的你</p>
        </div>
    </div>
    
    <!-- 花朵预览 -->
    <div class="flower-preview" id="flowerPreview" style="display: none;">
        <div class="flower-glow"></div>
        <div class="flower-container">
            <div class="flower-petal"></div>
            <div class="flower-petal"></div>
            <div class="flower-petal"></div>
            <div class="flower-petal"></div>
            <div class="flower-petal"></div>
            <div class="flower-center"></div>
        </div>
        <div class="flower-sparkle"></div>
        <div class="flower-sparkle"></div>
        <div class="flower-sparkle"></div>
        <div class="flower-sparkle"></div>
        <div class="flower-particle" style="left: 10%; animation-delay: 0s;"></div>
        <div class="flower-particle" style="left: 20%; animation-delay: 1s;"></div>
        <div class="flower-particle" style="left: 30%; animation-delay: 2s;"></div>
        <div class="flower-particle" style="right: 30%; animation-delay: 0.5s;"></div>
        <div class="flower-particle" style="right: 20%; animation-delay: 1.5s;"></div>
        <div class="flower-particle" style="right: 10%; animation-delay: 2.5s;"></div>
        <div class="flower-title">
            <h3>爱如花开</h3>
            <p>献给特别的你</p>
        </div>
    </div>
    
    <div class="form-group">
        <label for="letterTitle">情书名称</label>
        <input type="text" id="letterTitle" placeholder="例如：心动情书、爱的告白、520的信等">
    </div>
    
    <div class="form-group">
        <label for="recipient">收信人</label>
        <input type="text" id="recipient" placeholder="例如：亲爱的朋友">
    </div>
    
    <div class="form-group">
        <label for="currentParagraph">编写段落内容</label>
        <textarea id="currentParagraph" placeholder="写下这一段的内容..." style="min-height: 150px;"></textarea>
        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
            <span id="charCount" style="color: #666; font-size: 0.9rem;">当前段落：0字</span>
            <span id="totalCount" style="color: #666; font-size: 0.9rem;">总字数：0字</span>
        </div>
        <button id="addParagraphBtn" class="add-paragraph-btn">添加此段落</button>
    </div>
    
    <div class="form-group">
        <label>已添加的段落</label>
        <div class="paragraphs-container" id="paragraphsContainer">
            <!-- 段落会动态添加到这里 -->
        </div>
    </div>
    
    <div class="form-group">
        <label for="signature">署名</label>
        <input type="text" id="signature" placeholder="例如：爱你的朋友">
    </div>
    
    <div class="form-group">
        <label>情书颜色</label>
        <div class="color-picker" id="envelopeColors">
            <!-- 经典单色 -->
            <div class="color-option selected" style="background-color: #e74c3c;" data-color="#e74c3c" title="经典红色"></div>
            <div class="color-option" style="background-color: #9b59b6;" data-color="#9b59b6" title="紫罗兰"></div>
            <div class="color-option" style="background-color: #3498db;" data-color="#3498db" title="天空蓝"></div>
            <div class="color-option" style="background-color: #2ecc71;" data-color="#2ecc71" title="翡翠绿"></div>
            <div class="color-option" style="background-color: #f1c40f;" data-color="#f1c40f" title="金黄色"></div>
            <div class="color-option" style="background-color: #e67e22;" data-color="#e67e22" title="橙色"></div>
            
            <!-- 新增单色 -->
            <div class="color-option" style="background-color: #ff69b4;" data-color="#ff69b4" title="热情粉"></div>
            <div class="color-option" style="background-color: #8e44ad;" data-color="#8e44ad" title="深紫色"></div>
            <div class="color-option" style="background-color: #2c3e50;" data-color="#2c3e50" title="深蓝灰"></div>
            <div class="color-option" style="background-color: #16a085;" data-color="#16a085" title="青绿色"></div>
            <div class="color-option" style="background-color: #d35400;" data-color="#d35400" title="深橙色"></div>
            <div class="color-option" style="background-color: #c0392b;" data-color="#c0392b" title="深红色"></div>
            
            <!-- 更多单色 -->
            <div class="color-option" style="background-color: #ff1744;" data-color="#ff1744" title="玫瑰红"></div>
            <div class="color-option" style="background-color: #e91e63;" data-color="#e91e63" title="粉红色"></div>
            <div class="color-option" style="background-color: #673ab7;" data-color="#673ab7" title="深紫色"></div>
            <div class="color-option" style="background-color: #3f51b5;" data-color="#3f51b5" title="靛蓝色"></div>
            <div class="color-option" style="background-color: #2196f3;" data-color="#2196f3" title="蓝色"></div>
            <div class="color-option" style="background-color: #00bcd4;" data-color="#00bcd4" title="青色"></div>
            <div class="color-option" style="background-color: #009688;" data-color="#009688" title="青绿色"></div>
            <div class="color-option" style="background-color: #4caf50;" data-color="#4caf50" title="绿色"></div>
            <div class="color-option" style="background-color: #8bc34a;" data-color="#8bc34a" title="浅绿色"></div>
            <div class="color-option" style="background-color: #cddc39;" data-color="#cddc39" title="柠檬绿"></div>
            <div class="color-option" style="background-color: #ffeb3b;" data-color="#ffeb3b" title="黄色"></div>
            <div class="color-option" style="background-color: #ffc107;" data-color="#ffc107" title="琥珀色"></div>
            <div class="color-option" style="background-color: #ff9800;" data-color="#ff9800" title="橙色"></div>
            <div class="color-option" style="background-color: #ff5722;" data-color="#ff5722" title="深橙色"></div>
            <div class="color-option" style="background-color: #795548;" data-color="#795548" title="棕色"></div>
            <div class="color-option" style="background-color: #607d8b;" data-color="#607d8b" title="蓝灰色"></div>
            
            <!-- 经典渐变色选项 -->
            <div class="color-option" style="background: linear-gradient(135deg, #ff6b6b, #feca57);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ff6b6b, #feca57)" title="日落渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #a8edea, #fed6e3);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #a8edea, #fed6e3)" title="梦幻渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #ff9a9e, #fecfef);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ff9a9e, #fecfef)" title="粉色渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #667eea, #764ba2);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #667eea, #764ba2)" title="紫蓝渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #f093fb, #f5576c);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #f093fb, #f5576c)" title="浪漫渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #4facfe, #00f2fe);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #4facfe, #00f2fe)" title="蓝色渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #43e97b, #38f9d7);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #43e97b, #38f9d7)" title="绿色渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #fa709a, #fee140);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #fa709a, #fee140)" title="春日渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #ff8a80, #ff80ab);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ff8a80, #ff80ab)" title="珊瑚渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #b19cd9, #c9a9e8);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #b19cd9, #c9a9e8)" title="薰衣草渐变"></div>
            
            <!-- 新增炫彩渐变色 -->
            <div class="color-option" style="background: linear-gradient(135deg, #ff0844, #ffb199);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ff0844, #ffb199)" title="火焰渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #654ea3, #eaafc8);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #654ea3, #eaafc8)" title="紫粉渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #009ffd, #2a2a72);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #009ffd, #2a2a72)" title="深海渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #f093fb, #f5576c, #f093fb);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #f093fb, #f5576c, #f093fb)" title="三色渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ffecd2, #fcb69f)" title="暖阳渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #a8edea, #fed6e3, #d299c2);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #a8edea, #fed6e3, #d299c2)" title="彩虹渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #ff9a9e, #fad0c4, #ffd1ff);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ff9a9e, #fad0c4, #ffd1ff)" title="粉色三重奏"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #667eea, #764ba2, #f093fb)" title="紫色三重奏"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #4facfe, #00f2fe, #43e97b);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #4facfe, #00f2fe, #43e97b)" title="蓝绿三重奏"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #fa709a, #fee140, #fa709a);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #fa709a, #fee140, #fa709a)" title="黄粉三重奏"></div>
            
            <!-- 新增霓虹渐变 -->
            <div class="color-option" style="background: linear-gradient(135deg, #ff006e, #8338ec, #3a86ff);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ff006e, #8338ec, #3a86ff)" title="霓虹渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #ff7b00, #ff8500, #ff006e);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ff7b00, #ff8500, #ff006e)" title="火焰霓虹"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #00f5ff, #0080ff, #8000ff);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #00f5ff, #0080ff, #8000ff)" title="冰蓝霓虹"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #00ff88, #00ff00, #88ff00);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #00ff88, #00ff00, #88ff00)" title="绿色霓虹"></div>
            
            <!-- 新增金属质感渐变 -->
            <div class="color-option" style="background: linear-gradient(135deg, #ffd700, #ffed4e, #fff200);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #ffd700, #ffed4e, #fff200)" title="黄金渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #c0c0c0, #e8e8e8, #b8b8b8);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #c0c0c0, #e8e8e8, #b8b8b8)" title="银色渐变"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #cd7f32, #e6a85c, #d4af37);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #cd7f32, #e6a85c, #d4af37)" title="青铜渐变"></div>
            
            <!-- 新增宝石色渐变 -->
            <div class="color-option" style="background: linear-gradient(135deg, #e60026, #ff0040, #cc0033);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #e60026, #ff0040, #cc0033)" title="红宝石"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #0033cc, #0066ff, #003399);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #0033cc, #0066ff, #003399)" title="蓝宝石"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #00cc66, #00ff80, #009955);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #00cc66, #00ff80, #009955)" title="绿宝石"></div>
            <div class="color-option" style="background: linear-gradient(135deg, #cc00cc, #ff00ff, #990099);" 
                 data-color="gradient" data-gradient="linear-gradient(135deg, #cc00cc, #ff00ff, #990099)" title="紫水晶"></div>
        </div>
    </div>
    
    <div class="buttons">
        <button id="previewButton">预览情书</button>
        <button id="generateButton">生成链接</button>
        <button id="resetButton">重置</button>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const colorOptions = document.querySelectorAll('.color-option');
            const previewButton = document.getElementById('previewButton');
            const generateButton = document.getElementById('generateButton');
            const resetButton = document.getElementById('resetButton');
            const addParagraphBtn = document.getElementById('addParagraphBtn');
            const paragraphsContainer = document.getElementById('paragraphsContainer');
            const currentParagraph = document.getElementById('currentParagraph');
            const bookModeBtn = document.getElementById('bookModeBtn');
            const flowerModeBtn = document.getElementById('flowerModeBtn');
            const bookCoverPreview = document.getElementById('bookCoverPreview');
            const bookPreview = document.getElementById('bookPreview');
            const flowerPreview = document.getElementById('flowerPreview');
            
            // 存储所有段落
            let paragraphs = [];
            let editingIndex = -1;
            let useBookMode = true; // 默认使用书籍模式
            const charCountSpan = document.getElementById('charCount');
            const totalCountSpan = document.getElementById('totalCount');
            
            // 调整颜色亮度的辅助函数
            function adjustColor(color, percent) {
                let R = parseInt(color.substring(1, 3), 16);
                let G = parseInt(color.substring(3, 5), 16);
                let B = parseInt(color.substring(5, 7), 16);

                R = Math.max(0, Math.min(255, R + percent));
                G = Math.max(0, Math.min(255, G + percent));
                B = Math.max(0, Math.min(255, B + percent));

                const RR = ((R.toString(16).length === 1) ? "0" + R.toString(16) : R.toString(16));
                const GG = ((G.toString(16).length === 1) ? "0" + G.toString(16) : G.toString(16));
                const BB = ((B.toString(16).length === 1) ? "0" + B.toString(16) : B.toString(16));

                return "#" + RR + GG + BB;
            }
            
            // 颜色转换辅助函数
            function hexToRgb(hex) {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : null;
            }
            
            // 计算文本字数（不包括标点符号）
            function countTextChars(text) {
                if (!text) return 0;
                // 移除所有标点符号和空格，只保留中英文字符和数字
                return text.replace(/[\s\p{P}]/gu, '').length;
            }
            
            // 计算所有段落总字数（不包括标点符号）
            function countTotalChars(paragraphsArray) {
                if (!paragraphsArray || !paragraphsArray.length) return 0;
                return paragraphsArray.reduce((total, paragraph) => {
                    return total + countTextChars(paragraph);
                }, 0);
            }
            
            // 更新字数统计
            function updateCharCount() {
                const currentText = currentParagraph.value || '';
                const currentChars = countTextChars(currentText);
                const totalChars = countTotalChars(paragraphs);
                
                charCountSpan.textContent = `当前段落：${currentChars}字`;
                totalCountSpan.textContent = `总字数：${totalChars}字`;
            }
            
            // 更新预览（包括书籍和花朵）
            function updatePreview() {
                const selectedOption = document.querySelector('.color-option.selected');
                const color = selectedOption.getAttribute('data-color');
                const gradient = selectedOption.getAttribute('data-gradient');
                const letterTitle = document.getElementById('letterTitle').value || (useBookMode ? '爱意成册' : '爱如花开');
                const recipient = document.getElementById('recipient').value || '特别的你';
                
                if (useBookMode) {
                    // 更新书籍预览
                    if (color === 'gradient' && gradient) {
                        bookCoverPreview.style.background = gradient;
                        // 对于渐变色，书脊使用渐变的暗色版本
                        bookCoverPreview.querySelector('.book-spine').style.background = gradient;
                        bookCoverPreview.querySelector('.book-spine').style.filter = 'brightness(0.7)';
                    } else {
                        bookCoverPreview.style.backgroundColor = color;
                        bookCoverPreview.style.background = color;
                        bookCoverPreview.querySelector('.book-spine').style.backgroundColor = adjustColor(color, -30);
                        bookCoverPreview.querySelector('.book-spine').style.background = adjustColor(color, -30);
                        bookCoverPreview.querySelector('.book-spine').style.filter = 'none';
                    }
                    bookCoverPreview.querySelector('.book-preview-title').textContent = letterTitle;
                    const subtitle = bookCoverPreview.querySelector('p');
                    if (subtitle) {
                        subtitle.textContent = '献给 ' + recipient;
                    }
                } else {
                    // 更新花朵预览
                    const flowerPetals = flowerPreview.querySelectorAll('.flower-petal');
                    const flowerTitle = flowerPreview.querySelector('.flower-title h3');
                    const flowerSubtitle = flowerPreview.querySelector('.flower-title p');
                    const flowerGlow = flowerPreview.querySelector('.flower-glow');
                    
                    if (color === 'gradient' && gradient) {
                        // 处理渐变色花瓣
                        flowerPetals.forEach((petal, index) => {
                            // 为每个花瓣创建稍微不同的渐变变化
                            const rotationAngle = index * 72; // 每个花瓣间隔72度
                            petal.style.background = gradient;
                            petal.style.filter = `hue-rotate(${rotationAngle * 0.2}deg) brightness(${0.9 + (index * 0.05)})`;
                        });
                        
                        // 更新背景渐变
                        flowerPreview.style.background = gradient;
                        flowerPreview.style.filter = 'brightness(1.3)';
                        
                        // 更新光晕
                        if (flowerGlow) {
                            flowerGlow.style.background = gradient;
                            flowerGlow.style.opacity = '0.4';
                        }
                    } else {
                        // 处理单色
                        const baseColor = color;
                        const lightColor = adjustColor(color, 40);
                        const darkColor = adjustColor(color, -20);
                        
                        flowerPetals.forEach((petal, index) => {
                            const gradientColors = [
                                `linear-gradient(45deg, ${baseColor}, ${darkColor})`,
                                `linear-gradient(45deg, ${lightColor}, ${baseColor})`,
                                `linear-gradient(45deg, ${baseColor}, ${lightColor})`,
                                `linear-gradient(45deg, ${darkColor}, ${baseColor})`,
                                `linear-gradient(45deg, ${baseColor}, ${darkColor})`
                            ];
                            petal.style.background = gradientColors[index];
                            petal.style.filter = 'none';
                        });
                        
                        // 更新背景渐变
                        const bgLight = adjustColor(color, 60);
                        const bgMid = adjustColor(color, 30);
                        flowerPreview.style.background = `linear-gradient(135deg, ${bgLight} 0%, ${bgMid} 50%, ${bgMid} 100%)`;
                        flowerPreview.style.filter = 'none';
                        
                        // 更新光晕颜色
                        if (flowerGlow) {
                            const glowColor = adjustColor(color, 20);
                            const glowColorRgb = hexToRgb(glowColor);
                            if (glowColorRgb) {
                                flowerGlow.style.background = `radial-gradient(circle, rgba(${glowColorRgb.r},${glowColorRgb.g},${glowColorRgb.b},0.3) 0%, rgba(${glowColorRgb.r},${glowColorRgb.g},${glowColorRgb.b},0) 70%)`;
                                flowerGlow.style.opacity = '1';
                            }
                        }
                    }
                    
                    // 更新标题
                    if (flowerTitle) {
                        flowerTitle.textContent = letterTitle;
                    }
                    if (flowerSubtitle) {
                        flowerSubtitle.textContent = '献给 ' + recipient;
                    }
                }
            }
            
            // 渲染所有段落
            function renderParagraphs() {
                paragraphsContainer.innerHTML = '';
                
                if (paragraphs.length === 0) {
                    paragraphsContainer.innerHTML = '<p style="color: #888; text-align: center;">还没有添加段落，请在上方编写并添加</p>';
                    updateCharCount(); // 更新字数统计
                    return;
                }
                
                paragraphs.forEach((paragraph, index) => {
                    const paragraphItem = document.createElement('div');
                    paragraphItem.className = 'paragraph-item';
                    
                    const paragraphText = document.createElement('p');
                    paragraphText.textContent = paragraph;
                    paragraphItem.appendChild(paragraphText);
                    
                    // 显示段落字数
                    const charInfo = document.createElement('small');
                    charInfo.style.color = '#888';
                    charInfo.textContent = `${countTextChars(paragraph)}字（不含标点）`;
                    paragraphItem.appendChild(charInfo);
                    
                    const paragraphActions = document.createElement('div');
                    paragraphActions.className = 'paragraph-actions';
                    
                    const editButton = document.createElement('button');
                    editButton.className = 'edit-paragraph';
                    editButton.textContent = '编辑';
                    editButton.addEventListener('click', function() {
                        currentParagraph.value = paragraph;
                        editingIndex = index;
                        addParagraphBtn.textContent = '保存修改';
                        currentParagraph.focus();
                    });
                    
                    const removeButton = document.createElement('button');
                    removeButton.className = 'remove-paragraph';
                    removeButton.textContent = '删除';
                    removeButton.addEventListener('click', function() {
                        paragraphs.splice(index, 1);
                        renderParagraphs();
                    });
                    
                    const moveUpButton = document.createElement('button');
                    moveUpButton.textContent = '上移';
                    moveUpButton.style.display = index > 0 ? 'block' : 'none';
                    moveUpButton.addEventListener('click', function() {
                        if (index > 0) {
                            [paragraphs[index-1], paragraphs[index]] = [paragraphs[index], paragraphs[index-1]];
                            renderParagraphs();
                        }
                    });
                    
                    const moveDownButton = document.createElement('button');
                    moveDownButton.textContent = '下移';
                    moveDownButton.style.display = index < paragraphs.length - 1 ? 'block' : 'none';
                    moveDownButton.addEventListener('click', function() {
                        if (index < paragraphs.length - 1) {
                            [paragraphs[index], paragraphs[index+1]] = [paragraphs[index+1], paragraphs[index]];
                            renderParagraphs();
                        }
                    });
                    
                    paragraphActions.appendChild(editButton);
                    paragraphActions.appendChild(removeButton);
                    paragraphActions.appendChild(moveUpButton);
                    paragraphActions.appendChild(moveDownButton);
                    
                    paragraphItem.appendChild(paragraphActions);
                    paragraphsContainer.appendChild(paragraphItem);
                });
            }
            
            // 添加段落
            addParagraphBtn.addEventListener('click', function() {
                const paragraphText = currentParagraph.value.trim();
                if (paragraphText) {
                    if (editingIndex >= 0) {
                        // 更新现有段落
                        paragraphs[editingIndex] = paragraphText;
                        editingIndex = -1;
                        addParagraphBtn.textContent = '添加此段落';
                    } else {
                        // 添加新段落
                        paragraphs.push(paragraphText);
                    }
                    
                    currentParagraph.value = '';
                    renderParagraphs();
                    updateCharCount(); // 更新字数统计
                }
            });
            
            // 渲染所有段落
            renderParagraphs();
            
            // 监听文本输入，实时更新字数
            currentParagraph.addEventListener('input', updateCharCount);
            
            // 颜色选择
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    colorOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    updatePreview();
                });
            });
            
            // 样式模式切换
            bookModeBtn.addEventListener('click', function() {
                useBookMode = true;
                bookModeBtn.classList.add('active');
                flowerModeBtn.classList.remove('active');
                bookPreview.style.display = 'flex';
                flowerPreview.style.display = 'none';
                updatePreview();
            });
            
            flowerModeBtn.addEventListener('click', function() {
                useBookMode = false;
                flowerModeBtn.classList.add('active');
                bookModeBtn.classList.remove('active');
                bookPreview.style.display = 'none';
                flowerPreview.style.display = 'flex';
                updatePreview();
            });
            
            // 同步收信人到预览
            document.getElementById('recipient').addEventListener('input', function() {
                updatePreview();
            });
            
            // 同步情书名称到预览
            document.getElementById('letterTitle').addEventListener('input', function() {
                updatePreview();
            });
            
            // 预览功能
            previewButton.addEventListener('click', function() {
                if (paragraphs.length === 0) {
                    alert('请至少添加一段内容再预览！');
                    return;
                }
                
                const letterTitle = document.getElementById('letterTitle').value || '我的情书';
                const recipient = document.getElementById('recipient').value || '亲爱的朋友';
                const signature = document.getElementById('signature').value || '爱你的朋友';
                const selectedOption = document.querySelector('.color-option.selected');
                const selectedColor = selectedOption.getAttribute('data-color');
                const selectedGradient = selectedOption.getAttribute('data-gradient');
                
                // 创建预览窗口
                localStorage.setItem('letterData', JSON.stringify({
                    letterTitle,
                    recipient,
                    paragraphs,
                    signature,
                    color: selectedColor,
                    gradient: selectedGradient,
                    preview: true,
                    bookMode: useBookMode,
                    mode: useBookMode ? 'book' : 'flower',
                    autoOpen: true
                }));
                
                window.open('index.html?preview=true', '_blank');
            });
            
            // 生成链接
            generateButton.addEventListener('click', function() {
                if (paragraphs.length === 0) {
                    alert('请至少添加一段内容再生成链接！');
                    return;
                }
                
                const letterTitle = document.getElementById('letterTitle').value || '我的情书';
                const recipient = document.getElementById('recipient').value || '亲爱的朋友';
                const signature = document.getElementById('signature').value || '爱你的朋友';
                const selectedOption = document.querySelector('.color-option.selected');
                const selectedColor = selectedOption.getAttribute('data-color');
                const selectedGradient = selectedOption.getAttribute('data-gradient');
                
                // 创建数据对象
                const dataObj = {
                    t: letterTitle,  // 使用短键名减少体积
                    r: recipient,
                    p: paragraphs,
                    s: signature,
                    c: selectedColor,
                    g: selectedGradient, // 添加渐变信息
                    b: useBookMode,
                    m: useBookMode ? 'book' : 'flower'  // 添加模式标识
                };
                
                // 将数据对象转为JSON字符串
                const jsonStr = JSON.stringify(dataObj);
                
                // 使用LZString压缩数据（比普通编码减少约50-70%体积）
                const compressedData = LZString.compressToEncodedURIComponent(jsonStr);
                
                // 使用压缩后的数据构建URL
                const url = `${window.location.origin}${window.location.pathname.replace('customize.html', 'index.html')}?d=${compressedData}`;
                
                // 复制链接到剪贴板
                const tempInput = document.createElement('input');
                document.body.appendChild(tempInput);
                tempInput.value = url;
                tempInput.select();
                document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                alert('链接已压缩并复制到剪贴板，可以分享给朋友了！');
            });
            
            // 重置功能
            resetButton.addEventListener('click', function() {
                if (confirm('确定要重置所有内容吗？')) {
                    document.getElementById('letterTitle').value = '';
                    document.getElementById('recipient').value = '';
                    document.getElementById('currentParagraph').value = '';
                    document.getElementById('signature').value = '';
                    paragraphs = [];
                    renderParagraphs();
                    colorOptions.forEach(opt => opt.classList.remove('selected'));
                    colorOptions[0].classList.add('selected');
                    editingIndex = -1;
                    addParagraphBtn.textContent = '添加此段落';
                    
                    // 重置样式模式到书籍模式
                    useBookMode = true;
                    bookModeBtn.classList.add('active');
                    flowerModeBtn.classList.remove('active');
                    bookPreview.style.display = 'flex';
                    flowerPreview.style.display = 'none';
                    
                    updatePreview();
                    updateCharCount(); // 更新字数统计
                }
            });
            
            // 初始化
            updatePreview();
            updateCharCount(); // 初始化字数统计
        });
    </script>
</body>
</html> 